
export * from "./react.js";

export function generateImageUrl(prompt, model = "cinematic-realism") {
  if (typeof prompt !== "string" || !prompt.trim()) {
    throw new TypeError("Prompt must be a non-empty string.");
  }

  const seed = Math.floor(Math.random() * 1000000);
  return `https://image.pollinations.ai/prompt/${encodeURIComponent(
    prompt
  )}?model=${encodeURIComponent(model)}&seed=${seed}`;
}

export async function fetchImageBlob(prompt, model = "cinematic-realism") {
  const url = generateImageUrl(prompt, model);
  const res = await fetch(url);
  if (!res.ok) throw new Error(`Failed to fetch image: ${res.status}`);
  return await res.blob();
}

export async function fetchImageBuffer(prompt, model = "cinematic-realism") {
  const url = generateImageUrl(prompt, model);

  let res;
  if (typeof fetch === "undefined") {
    const { default: nodeFetch } = await import("node-fetch");
    res = await nodeFetch(url);
  } else {
    res = await fetch(url);
  }

  if (!res.ok) throw new Error(`Failed to fetch image: ${res.status}`);
  const arrayBuffer = await res.arrayBuffer();
  return Buffer.from(arrayBuffer);
}
